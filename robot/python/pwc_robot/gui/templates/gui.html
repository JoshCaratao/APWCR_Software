<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>APWCR Dashboard</title>

    <!-- CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/gui.css') }}"
    />

    <!-- JS -->
    <script
      src="{{ url_for('static', filename='js/gui.js') }}"
      defer
    ></script>
  </head>

  <body>
    <script id="guiConfig" type="application/json">
      {
        "manual_speed_linear": {{ manual_speed_linear|tojson }},
        "manual_speed_angular": {{ manual_speed_angular|tojson }}
      }
    </script>

    <!-- ===================== -->
    <!-- HEADER -->
    <!-- ===================== -->
    <header>
      <div class="title">
        <div id="statusDot" class="dot"></div>
        <h1>Autonomous Pet Waste Collection Robot User Interface</h1>
        <div class="subtitle" id="subTitle">connecting...</div>
      </div>
    </header>

    <!-- ===================== -->
    <!-- MAIN GRID -->
    <!-- ===================== -->
    <main>
      <div class="grid">

        <!-- ===================== -->
        <!-- LEFT: PERCEPTION -->
        <!-- ===================== -->
        <section class="card">
          <div class="card-header">
            <h2>PERCEPTION WINDOW</h2>
            <span class="pill">
              <span class="mono">/perception/status</span>
            </span>
          </div>

          <div class="card-body">
            <div class="section-title">DETECTION DATA</div>
            <div class="stats">
              <div class="stat stat-wide">
                <div class="k">DETECTION STATUS</div>
                <div class="v" id="detectionStatusValue">CONNECTING</div>
              </div>

              <div class="stat">
                <div class="k"># DETECTIONS</div>
                <div class="v" id="detectionsValue">0</div>
              </div>

              <div class="stat">
                <div class="k">CONFIG INFERENCE SPEED</div>
                <div class="v" id="targetInferHzValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">MEASURED INFERENCE SPEED</div>
                <div class="v" id="measuredInferHzValue">N/A</div>
              </div>
            </div>

            <div class="section-spacer"></div>

            <div class="section-title">TARGET DATA</div>
            <div class="stats">
              <div class="stat stat-wide">
                <div class="k">TARGET STATUS</div>
                <div class="v" id="targetStatusValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">TARGET MODE</div>
                <div class="v mono" id="targetModeValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">DETECTION CONFIDENCE</div>
                <div class="v" id="targetConfValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">DETECTED PIXEL AREA</div>
                <div class="v" id="targetAreaValue">N/A</div>
              </div>

              <div class="stat stat-wide">
                <div class="k">TARGET CENTER (cx, cy)</div>
                <div class="v mono" id="targetCenterValue">N/A</div>
              </div>
            </div>
          </div>
        </section>

        <!-- ===================== -->
        <!-- CENTER: VIDEO -->
        <!-- ===================== -->
        <section class="card">
          <div class="card-header">
            <h2>LIVE DETECTION STREAM</h2>
            <span class="pill">
              <span class="mono">/stream/comp_vision</span>
            </span>
          </div>

          <div class="card-body">
            <img
              class="stream"
              src="/stream/comp_vision"
              alt="Video stream"
            />
          </div>
        </section>

        <!-- ===================== -->
        <!-- RIGHT: CONTROL -->
        <!-- ===================== -->
        <section class="card">
          <div class="card-header">
            <h2>CONTROL WINDOW</h2>
            <span class="pill">
              <span class="mono">/controller</span>
            </span>
          </div>

          <div class="card-body">
            <div class="section-title">CONTROL STATUS</div>
            <div class="stats">
              <div class="stat stat-wide">
                <div class="k">CURRENT CONTROL STATE</div>
                <div class="v" id="controlStateValue">CONNECTING</div>
              </div>

              <div class="stat stat-wide">
                <div class="k">CURRENT DRIVE COMMANDS</div>
                <div class="v mono" id="driveCmdValue">
                  speed = 0.00 m/s, turn = 0.00 deg/s
                </div>
              </div>

              <!-- NEW: Mechanism Commands -->
              <div class="stat stat-wide">
                <div class="k">CURRENT MECHANISM COMMANDS (Degs)</div>
                <div class="v mono" id="mechCmdValue">
                  Bucket Lift Motor = N/A, Bucket Rotation Motor = POS_DEG 0.0, Lid Servo = N/A, Sweeper Servo = N/A
                </div>
              </div>
            </div>

            <div class="section-spacer"></div>

            <div class="section-title">MODE SELECT</div>
            <div class="control-row">
              <button id="btnModeManual" class="btn" type="button">
                MANUAL
              </button>
              <button id="btnModeAuto" class="btn" type="button">
                AUTO
              </button>
            </div>

            <div class="section-spacer"></div>

            <div class="section-title">MANUAL TELEOP</div>

            <div id="teleopPad" class="teleop-pad disabled">
              <div class="teleop-grid">
                <div></div>
                <button id="btnFwd" class="btn teleop-btn">↑</button>
                <div></div>

                <button id="btnLeft" class="btn teleop-btn">←</button>
                <button id="btnStop" class="btn teleop-btn">■</button>
                <button id="btnRight" class="btn teleop-btn">→</button>

                <div></div>
                <button id="btnRev" class="btn teleop-btn">↓</button>
                <div></div>
              </div>

              <div class="footer-note">
                Teleop is enabled only in MANUAL mode. Releasing a button sends STOP.
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </body>
</html>

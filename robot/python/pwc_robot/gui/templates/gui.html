<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>APWCR Dashboard</title>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/gui.css') }}"
    />

    <script
      src="{{ url_for('static', filename='js/gui.js') }}"
      defer
    ></script>
  </head>

  <body>
    <script id="guiConfig" type="application/json">
      {
        "manual_speed_linear": {{ manual_speed_linear|tojson }},
        "manual_speed_angular": {{ manual_speed_angular|tojson }}
      }
    </script>

    <!-- ===================== -->
    <!-- HEADER -->
    <!-- ===================== -->
    <header>
      <div class="title">
        <div id="statusDot" class="dot"></div>
        <h1>Autonomous Pet Waste Collection Robot User Interface</h1>
        <div class="subtitle" id="subTitle">connecting...</div>
      </div>
    </header>

    <!-- ===================== -->
    <!-- MAIN GRID -->
    <!-- ===================== -->
    <main>
      <div class="grid">

        <!-- ===================== -->
        <!-- LEFT: PERCEPTION -->
        <!-- ===================== -->
        <section class="card">
          <div class="card-header">
            <h2>PERCEPTION WINDOW</h2>
            <span class="pill mono">/perception/status</span>
          </div>

          <div class="card-body">
            <!-- ===================== -->
            <!-- DETECTION DATA -->
            <!-- ===================== -->
            <div class="section-title">DETECTION DATA</div>

            <!-- Row: Detection status + count -->
            <div class="stats stats-2col-tight">
              <div class="stat">
                <div class="k">DETECTION STATUS</div>
                <div class="v" id="detectionStatusValue">CONNECTING</div>
              </div>

              <div class="stat">
                <div class="k"># DETECTIONS</div>
                <div class="v" id="detectionsValue">0</div>
              </div>
            </div>

            <!-- Row: Inference speeds -->
            <div class="stats stats-2col-tight">
              <div class="stat">
                <div class="k">CONFIG INFERENCE SPEED</div>
                <div class="v" id="targetInferHzValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">MEASURED INFERENCE SPEED</div>
                <div class="v" id="measuredInferHzValue">N/A</div>
              </div>
            </div>

            <div class="section-spacer"></div>

            <!-- ===================== -->
            <!-- TARGET DATA -->
            <!-- ===================== -->
            <div class="section-title">TARGET DATA</div>

            <!-- Row: Target status + mode -->
            <div class="stats stats-2col-tight">
              <div class="stat">
                <div class="k">TARGET STATUS</div>
                <div class="v" id="targetStatusValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">TARGET MODE</div>
                <div class="v mono" id="targetModeValue">N/A</div>
              </div>
            </div>

            <!-- Row: Confidence + area -->
            <div class="stats stats-2col-tight">
              <div class="stat">
                <div class="k">DETECTION CONFIDENCE</div>
                <div class="v" id="targetConfValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">DETECTED PIXEL AREA</div>
                <div class="v" id="targetAreaValue">N/A</div>
              </div>
            </div>

            <!-- Row: Target center (full width) -->
            <div class="stats">
              <div class="stat stat-wide">
                <div class="k">TARGET CENTER (cx, cy)</div>
                <div class="v mono" id="targetCenterValue">N/A</div>
              </div>
            </div>

            <div class="section-spacer"></div>

            <!-- ===================== -->
            <!-- GROUND PLANE -->
            <!-- ===================== -->
            <div class="section-title">GROUND PLANE POSITION ESTIMATE</div>

            <!-- Row: Ground range + lateral -->
            <div class="stats stats-2col-tight">
              <div class="stat">
                <div class="k">GROUND RANGE (FT)</div>
                <div class="v" id="targetGpFwValue">N/A</div>
              </div>

              <div class="stat">
                <div class="k">GROUND LATERAL (FT)</div>
                <div class="v" id="targetGpLtValue">N/A</div>
              </div>
            </div>

            <!-- Row: Ground plane valid (full width, like a status line) -->
            <div class="stats">
              <div class="stat stat-wide">
                <div class="k">GROUND PLANE VALID</div>
                <div class="v mono" id="targetGpValidValue">false</div>
              </div>
            </div>
          </div>
        </section>



        <!-- ===================== -->
        <!-- CENTER: VIDEO + TELEMETRY -->
        <!-- ===================== -->
        <div class="centerCol">

          <!-- STREAM -->
          <section class="card">
            <div class="card-header">
              <h2>LIVE DETECTION STREAM</h2>
              <span class="pill mono">/stream/comp_vision</span>
            </div>

            <div class="card-body">
              <img class="stream" src="/stream/comp_vision" alt="Video stream" />
            </div>
          </section>

          <!-- TELEMETRY -->
          <section class="card">
            <div class="card-header">
              <h2>TELEMETRY WINDOW</h2>
              <span class="pill mono">/telemetry/status</span>
            </div>

            <div class="card-body">
              <div class="section-title">LINK</div>

              <!-- CONNECTION + PORT HEALTH (same row) -->
              <div class="stats stats-2col-tight">
                <div class="stat">
                  <div class="k">CONNECTION STATE</div>
                  <div class="v" id="telConnState">DISCONNECTED</div>
                </div>

                <div class="stat">
                  <div class="k">PORT / HEALTH</div>
                  <div class="v mono" id="telConnMeta">N/A</div>
                </div>
              </div>

              <div class="section-spacer"></div>

              <!-- COMMS RATES (same row) -->
              <div class="stats stats-3col">
                <div class="stat">
                  <div class="k">COMMS TICK</div>
                  <div class="v" id="telTickHz">N/A</div>
                </div>

                <div class="stat">
                  <div class="k">RX RATE</div>
                  <div class="v" id="telRxHz">N/A</div>
                </div>

                <div class="stat">
                  <div class="k">TX RATE</div>
                  <div class="v" id="telTxHz">N/A</div>
                </div>
              </div>

              <div class="section-spacer"></div>

              <div class="section-title">ARDUINO TELEMETRY FEEDBACK</div>

              <!-- WHEEL + MECH + ULTRASONIC (same row, if space) -->
              <div class="stats stats-3col">
                <div class="stat">
                  <div class="k">WHEEL STATE (RPM)</div>
                  <div class="v mono" id="telWheelState">N/A</div>
                </div>

                <div class="stat">
                  <div class="k">MECH STATE (DEG)</div>
                  <div class="v mono" id="telMechState">N/A</div>
                </div>

                <div class="stat">
                  <div class="k">ULTRASONIC DISTANCE SENSOR (IN)</div>
                  <div class="v mono" id="telUltrasonic">N/A</div>
                </div>
              </div>
            </div>
          </section>
        </div>


        <!-- ===================== -->
        <!-- RIGHT: CONTROL -->
        <!-- ===================== -->
        <section class="card">
          <div class="card-header">
            <h2>CONTROL WINDOW</h2>
            <span class="pill mono">/controller</span>
          </div>

          <div class="card-body">
            <div class="section-title">CONTROL STATUS</div>

            <div class="stats">
              <div class="stat stat-wide">
                <div class="k">CURRENT CONTROL STATE</div>
                <div class="v" id="controlStateValue">CONNECTING</div>
              </div>

              <div class="stat stat-wide">
                <div class="k">CURRENT DRIVE COMMANDS</div>
                <div class="v mono" id="driveCmdValue">
                  Linear Speed = 0.00 ft/s, Turn Speed = 0.00 deg/s
                </div>
              </div>

              <div class="stat stat-wide">
                <div class="k">CURRENT MECHANISM COMMANDS (DEG)</div>
                <div class="v mono" id="mechCmdValue">N/A</div>
              </div>
            </div>

            <div class="section-spacer"></div>

            <div class="section-title">MODE SELECT</div>
            <div class="control-row">
              <button id="btnModeManual" class="btn">MANUAL</button>
              <button id="btnModeAuto" class="btn">AUTO</button>
            </div>

            <div class="section-spacer"></div>

            <div class="section-title">MANUAL TELEOP</div>

            <div id="teleopPad" class="teleop-pad disabled">
              <div class="teleop-grid">
                <div></div>
                <button id="btnFwd" class="btn teleop-btn">↑</button>
                <div></div>

                <button id="btnLeft" class="btn teleop-btn">←</button>
                <button id="btnStop" class="btn teleop-btn">■</button>
                <button id="btnRight" class="btn teleop-btn">→</button>

                <div></div>
                <button id="btnRev" class="btn teleop-btn">↓</button>
                <div></div>
              </div>

              <div class="footer-note">
                Teleop is enabled only in MANUAL mode. Releasing a button sends STOP.
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </body>
</html>
